// ================================
// FILE: app/layout.tsx
// ================================
import "./globals.css";

export const metadata = {
  title: "Flores com Three.js",
  description: "Landing com animação de flores e fundo 3D.",
};

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="pt-BR">
      <body>{children}</body>
    </html>
  );
}

// ================================
// FILE: app/page.tsx
// ================================
import AnimatedFlowers from "./components/AnimatedFlowers";
import ThreeBackground from "./components/ThreeBackground";

export default function Page() {
  return (
    <>
      <ThreeBackground />

      <main
        style={{
          height: "100vh",
          display: "flex",
          justifyContent: "center",
          alignItems: "center",
        }}
      >
        <AnimatedFlowers />
      </main>
    </>
  );
}

// ================================
// FILE: app/components/AnimatedFlowers.tsx
// ================================
"use client";

export default function AnimatedFlowers() {
  return (
    <div className="animated-flowers-wrapper">
      <div className="flowers">
        {/* Grama esquerda */}
        <div className="grass grass--left">
          <div className="grass__leaf"></div>
          <div className="grass__leaf"></div>
          <div className="grass__leaf"></div>
          <div className="grass__leaf"></div>
        </div>

        {/* Grama direita */}
        <div className="grass grass--right">
          <div className="grass__leaf"></div>
          <div className="grass__leaf"></div>
          <div className="grass__leaf"></div>
          <div className="grass__leaf"></div>
        </div>

        {/* Folhas da base */}
        <div className="flower__leaf t--1"></div>
        <div className="flower__leaf t--2"></div>
        <div className="flower__leaf t--3"></div>
        <div className="flower__leaf t--4"></div>
        <div className="flower__leaf t--5"></div>

        {/* Flores principais */}
        <div className="flower flower--1">
          <div className="flower__stem"></div>
          <div className="flower__head">
            <div className="flower__petal"></div>
            <div className="flower__petal"></div>
            <div className="flower__petal"></div>
            <div className="flower__center"></div>
          </div>
        </div>

        <div className="flower flower--2">
          <div className="flower__stem"></div>
          <div className="flower__head">
            <div className="flower__petal"></div>
            <div className="flower__petal"></div>
            <div className="flower__petal"></div>
            <div className="flower__center"></div>
          </div>
        </div>

        <div className="flower flower--3">
          <div className="flower__stem"></div>
          <div className="flower__head">
            <div className="flower__petal"></div>
            <div className="flower__petal"></div>
            <div className="flower__petal"></div>
            <div className="flower__center"></div>
          </div>
        </div>

        {/* Luzinhas em CSS */}
        <div className="flower__light t--1"></div>
        <div className="flower__light t--2"></div>
        <div className="flower__light t--3"></div>
        <div className="flower__light t--4"></div>
      </div>

      <div className="noise"></div>
    </div>
  );
}

// ================================
// FILE: app/components/ThreeBackground.tsx
// ================================
"use client";

import { useEffect, useRef } from "react";
import * as THREE from "three";

export default function ThreeBackground() {
  const canvasRef = useRef<HTMLCanvasElement | null>(null);

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;

    const scene = new THREE.Scene();
    scene.fog = new THREE.FogExp2(0x020308, 0.06);

    const camera = new THREE.PerspectiveCamera(
      60,
      window.innerWidth / window.innerHeight,
      0.1,
      100
    );
    camera.position.set(0, 0, 8);

    const renderer = new THREE.WebGLRenderer({
      canvas,
      antialias: true,
    });
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setClearColor(0x020308, 1);

    // Partículas
    const particleCount = 400;
    const positions = new Float32Array(particleCount * 3);

    for (let i = 0; i < particleCount; i++) {
      const i3 = i * 3;
      positions[i3 + 0] = (Math.random() - 0.5) * 20; // x
      positions[i3 + 1] = Math.random() * 6 - 1; // y
      positions[i3 + 2] = Math.random() * -15; // z (pra trás)
    }

    const geometry = new THREE.BufferGeometry();
    geometry.setAttribute("position", new THREE.BufferAttribute(positions, 3));

    const material = new THREE.PointsMaterial({
      size: 0.06,
      transparent: true,
      opacity: 0.9,
    });

    const points = new THREE.Points(geometry, material);
    scene.add(points);

    // Movimento suave com mouse
    const mouse = { x: 0, y: 0 };

    const onMouseMove = (event: MouseEvent) => {
      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
    };

    window.addEventListener("mousemove", onMouseMove);

    let animationFrameId: number;

    const animate = () => {
      animationFrameId = requestAnimationFrame(animate);

      const positionArray = geometry.attributes.position.array as Float32Array;

      for (let i = 0; i < particleCount; i++) {
        const i3 = i * 3;
        positionArray[i3 + 1] += 0.003;

        if (positionArray[i3 + 1] > 4) {
          positionArray[i3 + 1] = -2 - Math.random() * 2;
        }
      }

      geometry.attributes.position.needsUpdate = true;

      camera.position.x += (mouse.x * 1.2 - camera.position.x) * 0.02;
      camera.position.y += (mouse.y * 0.6 - camera.position.y) * 0.02;
      camera.lookAt(0, 0, -5);

      renderer.render(scene, camera);
    };

    animate();

    const onResize = () => {
      const width = window.innerWidth;
      const height = window.innerHeight;
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
      renderer.setSize(width, height);
    };

    window.addEventListener("resize", onResize);

    return () => {
      cancelAnimationFrame(animationFrameId);
      window.removeEventListener("mousemove", onMouseMove);
      window.removeEventListener("resize", onResize);
      renderer.dispose();
      geometry.dispose();
      material.dispose();
    };
  }, []);

  return <canvas id="bg-canvas" ref={canvasRef} />;
}

// ================================
// FILE: app/globals.css
// ================================
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html,
body {
  height: 100%;
  margin: 0;
  overflow: hidden;
  background: #020308;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

/* Canvas Three.js fixo no fundo */
#bg-canvas {
  position: fixed;
  inset: 0;
  z-index: -2;
  display: block;
}

/* Wrapper da animação */
.animated-flowers-wrapper {
  position: relative;
  width: 100%;
  max-width: 900px;
  display: flex;
  justify-content: center;
  align-items: center;
  padding-block: 3rem;
  background: radial-gradient(circle at 20% 20%, #0b2832 0, #050910 45%, #020307 100%);
  overflow: hidden;
  border-radius: 24px;
  box-shadow: 0 24px 60px rgba(0, 0, 0, 0.7);
  margin: auto;
  margin-top: 60px;
}

/* Container das flores */
.flowers {
  position: relative;
  width: 360px;
  height: 260px;
  transform-origin: center bottom;
  perspective: 1000px;
}

/* FLORES */
.flower {
  position: absolute;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  animation: sway 6s ease-in-out infinite alternate;
}

.flower--1 {
  transform: translateX(-50%) scale(1);
}

.flower--2 {
  transform: translate(-120%, 0) scale(0.9);
  animation-duration: 7s;
}

.flower--3 {
  transform: translate(20%, 0) scale(1.05);
  animation-duration: 5.5s;
}

.flower__stem {
  position: relative;
  width: 8px;
  height: 150px;
  margin: 0 auto;
  border-radius: 999px;
  background: linear-gradient(to top, #0a3a3a, #197b7d);
  box-shadow: 0 0 10px rgba(46, 255, 255, 0.4);
}

/* Cabeça da flor */
.flower__head {
  position: absolute;
  top: -25px;
  left: 50%;
  transform: translateX(-50%);
  width: 70px;
  height: 40px;
}

.flower__center {
  position: absolute;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  width: 22px;
  height: 22px;
  border-radius: 999px;
  background: radial-gradient(circle, #fff9b7 0, #ffeb6a 40%, #f9c94c 100%);
  box-shadow: 0 0 18px rgba(255, 241, 173, 0.9);
  z-index: 2;
}

.flower__petal {
  position: absolute;
  width: 34px;
  height: 20px;
  border-radius: 999px;
  background: radial-gradient(circle at 30% 20%, #d7ffff 0, #7be3de 40%, #3baea9 100%);
  box-shadow: 0 0 15px rgba(121, 252, 255, 0.5);
  transform-origin: center center;
}

.flower__petal:nth-child(1) {
  left: 50%;
  top: 0;
  transform: translateX(-50%);
}

.flower__petal:nth-child(2) {
  left: 0;
  top: 14px;
  transform: rotate(-25deg);
}

.flower__petal:nth-child(3) {
  right: 0;
  top: 14px;
  transform: rotate(25deg);
}

/* FOLHAS DA BASE */
.flower__leaf {
  position: absolute;
  bottom: 0;
  left: 50%;
  width: 70px;
  height: 36px;
  border-radius: 60px;
  background: radial-gradient(circle at 20% 30%, #6bf0ff 0, #28a69c 40%, #0c4b4a 100%);
  transform-origin: right center;
  box-shadow: 0 0 18px rgba(73, 242, 255, 0.45);
  opacity: 0.9;
  animation: sway-leaf 7s ease-in-out infinite alternate;
}

.flower__leaf.t--1 {
  transform: translate(-40%, -10px) rotate(-22deg) scale(1.05);
}

.flower__leaf.t--2 {
  transform: translate(-55%, 5px) rotate(-8deg);
}

.flower__leaf.t--3 {
  transform: translate(-60%, 20px) rotate(7deg) scale(0.95);
}

.flower__leaf.t--4 {
  transform: translate(-50%, 35px) rotate(18deg) scale(0.9);
}

.flower__leaf.t--5 {
  transform: translate(-30%, 50px) rotate(30deg) scale(0.85);
}

/* GRAMA */
.grass {
  position: absolute;
  bottom: 0;
  width: 120px;
  height: 220px;
}

.grass--left {
  left: -10px;
}

.grass--right {
  right: -10px;
  transform: scaleX(-1);
}

.grass__leaf {
  position: absolute;
  bottom: 0;
  width: 12px;
  height: 150px;
  border-radius: 999px;
  background: linear-gradient(to top, #013929, #0f7150);
  transform-origin: bottom center;
  animation: sway-leaf 7s ease-in-out infinite alternate;
}

.grass__leaf:nth-child(1) {
  left: 0;
  transform: rotate(-10deg);
}

.grass__leaf:nth-child(2) {
  left: 20px;
  transform: rotate(8deg);
  height: 170px;
}

.grass__leaf:nth-child(3) {
  left: 40px;
  transform: rotate(-18deg);
  height: 190px;
}

.grass__leaf:nth-child(4) {
  left: 60px;
  transform: rotate(15deg);
  height: 160px;
}

/* LUZINHAS */
.flower__light {
  position: absolute;
  width: 6px;
  height: 6px;
  border-radius: 999px;
  background: radial-gradient(circle, #fffce1 0, #ffe26f 45%, transparent 70%);
  box-shadow: 0 0 10px rgba(255, 246, 196, 0.9);
  opacity: 0;
  animation: firefly 4s linear infinite;
}

.flower__light.t--1 {
  left: 45%;
  bottom: 140px;
  animation-delay: -0.5s;
}

.flower__light.t--2 {
  left: 60%;
  bottom: 160px;
  animation-delay: -1.3s;
}

.flower__light.t--3 {
  left: 35%;
  bottom: 180px;
  animation-delay: -2.1s;
}

.flower__light.t--4 {
  left: 55%;
  bottom: 200px;
  animation-delay: -2.7s;
}

/* ANIMAÇÕES */
@keyframes sway {
  0% {
    transform: translateX(-50%) rotate(-2deg);
  }
  100% {
    transform: translateX(-50%) rotate(3deg);
  }
}

@keyframes sway-leaf {
  0% {
    transform: translate(-50%, 20px) rotate(-8deg) scale(1);
  }
  100% {
    transform: translate(-52%, 22px) rotate(4deg) scale(1.03);
  }
}

@keyframes firefly {
  0% {
    transform: translate3d(0, 0, 0) scale(0.5);
    opacity: 0;
  }
  20% {
    opacity: 1;
  }
  60% {
    transform: translate3d(10px, -40px, 0) scale(1);
    opacity: 1;
  }
  100% {
    transform: translate3d(-5px, -80px, 0) scale(0.4);
    opacity: 0;
  }
}

/* Ruído por cima */
.noise {
  pointer-events: none;
  position: absolute;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cfilter id='n' x='0' y='0'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='2' stitchTiles='noStitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.08'/%3E%3C/svg%3E");
  mix-blend-mode: soft-light;
  opacity: 0.25;
  z-index: 1;
}
